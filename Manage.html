<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>ממשק ניהול</title>
</head>

<body onload="onLoad()">
    <link href="styleSheets/SharedStyleSheet.css" rel="stylesheet" />
    <link href="styleSheets/ManageStyleSheet.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/ag-grid-community.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/xlsx.full.min.js"></script>
    <script src="js/shared.js"></script>
    <script>
        var manageConfig = ""
        var gridOptions
        var counter = 0;
        var gridDiv

        function onLoad() {
            fileName = 'manageConfig'
            window.expose.SendExcel("sendReadExcel", fileName);
            window.expose.ReceiveExcel("receiveReadExcel" + fileName, (data) => {
                if (data != 0) {
                    manageConfig = JSON.parse(data)
                    gridOptions = {
                        columnDefs: [
                            { headerName: "שם", field: "name", editable: true },
                            { headerName: "תיאור", field: "description", editable: true },
                            { headerName: "מספר זוכה", field: "lotteryNumber" },
                            {
                                field: "delete", icons: {
                                },
                            },

                        ],
                        rowData: manageConfig.gifts,
                        onFirstDataRendered: onFirstDataRendered,
                        onCellEditingStopped: onCellEditingStopped
                    };
                    gridDiv = document.querySelector('#giftsGrid');
                    new agGrid.Grid(gridDiv, gridOptions);
                }
            })
        }

        document.addEventListener("keypress", function (e) {
            if (e.target.tagName !== "INPUT") {
                var input = document.querySelector(".my-input");
                input.focus();
                input.value = e.key;
                e.preventDefault();
            }
            counter += 1;
            if (counter > 9) {
                if (document.getElementById('code').value == '011429519')
                    login("System")
            }
        });

        function onFirstDataRendered(params) {
            gridOptions.api.sizeColumnsToFit({
                defaultMinWidth: 50,
            });
        }

        function New() {
            var id = 1
            if (manageConfig.gifts.length > 0) {
                id = manageConfig.gifts[manageConfig.gifts.length - 1].id + 1
            }
            manageConfig.gifts.push({
                "id": id,
                "name": "",
                "description": "",
                "lotteryNumber": null
            })
            fileName = 'manageConfig'
            window.expose.SendExcel("sendWriteExcel", [fileName, JSON.stringify(manageConfig)]);
            window.expose.ReceiveExcel("receiveWriteExcel" + fileName, (data) => {
                location.reload()
            });
        }

        function onCellEditingStopped(params) {
            fileName = 'manageConfig'
            window.expose.SendExcel("sendWriteExcel", [fileName, JSON.stringify(manageConfig)]);
            window.expose.ReceiveExcel("receiveWriteExcel" + fileName, (data) => {
            });
        }

        function Export(name) {
            var params = {
                fileName: name,
            };
            gridOptions.api.exportDataAsCsv(params);
        }

        function deleteRow() {
            const selectedRows = gridDiv.getSelectedRows(); // Assuming you want to delete the selected row(s)

            if (selectedRows.length === 0) {
                alert("Please select a row to delete.");
                return;
            }

            gridOptions.api.updateRowData({ remove: selectedRows });
        }
    </script>
    <div class="background" id="background">
        <div class="text">
            <div id="line1">ברוכה הבאה לממשק ניהול</div>
            <div id="line2">כאן אפשר להוסיף משימות ולהוריד את הנתונים</div>
            <!-- <button onclick="deleteRow()">Delete Row</button> -->

            <div style="height: 30px; width: 30%; float:right">
                <!-- <img class="circle" onclick="expose.appClose()" src="resources/icons/close.svg" /> -->
                <img class="circle" onclick="Export('רשימת הזוכים')" src="resources/icons/arrow-down.svg" />
                <img class="circle" onclick="New()" src="resources/icons/add.svg" />
            </div>
            <div id="giftsGrid" style="width:80%" class="ag-theme-alpine"></div>
            <div class="menue">
                <div style="width: 50%; text-align: left;">
                    <img class="circle" onclick="login('User')" src="resources/icons/sparkles-outline.svg"
                        style="padding: 7px;" />
                </div>
            </div>
        </div>
        <input type="text" class="my-input" id="code">
    </div>
</body>

</html>